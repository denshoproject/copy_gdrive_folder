# Google Drive Folder Copy Script -- `copy_gdrive_folder.py`

This script -- `copy_gdrive_folder.py -- copies the contents of a source folder to a temporary location within the organization's Google Drive, and then moves the content to a specified Shared Drive. It uses a Google service account to impersonate a specified user.

NOTE: Most of this code was generated by GPT4o. If this is the kind of job that the robots want to take from me, they're free to have it.

## Features

- Copies the folder structure and files from a source folder to a temporary location.
- Moves the copied content from the temporary location to a Shared Drive.
- Logs any failed copy operations to a CSV file with a timestamp.

## Prerequisites

1. **Google Cloud Project**: Set up a project in the [Google Cloud Console](https://console.cloud.google.com/).
2. **Enable Google Drive API**: Enable the Google Drive API for your project.
3. **Service Account**: Create a service account and download the JSON key file.
4. **Domain-Wide Delegation**: Grant domain-wide delegation to the service account and authorize it to impersonate users in your domain.
5. **Python Libraries**: Install the required Python libraries.

```bash
pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client pyyaml
```
(For additional info/background on configuring Google Drive API, see, `GoogleDriveAPISetup.md`, included in this repo.)

## Configuration
Create a config.yaml file with the following structure:

```yaml
service_account_file: 'path_to_your_service_account.json'
delegated_user_email: 'user@example.com'
source_folder_id: 'your_source_folder_id'
temp_parent_folder_id: 'your_temp_parent_folder_id'
shared_drive_folder_id: 'your_shared_drive_folder_id'
```

- `service_account_file`: Path to your service account JSON key file.
- `delegated_user_email`: The email of the user to impersonate.
- `source_folder_id`: The ID of the source folder you want to copy.
- `temp_parent_folder_id`: The ID of the temporary parent folder where the source folder will be copied.
- `shared_drive_folder_id`: The ID of the destination parent folder in the Shared Drive.

## Usage
1. **Clone the Repository**: Clone or download this repository to your local machine.

2. **Install Dependencies**: Install the required Python libraries (as shown above).

3. **Configure**: Create and fill out the config.yaml file with the appropriate values.

4. **Run the Script**: Execute the script using Python.

``` bash
python copy_gdrive_folder.py
```

## Script Details

### Script Overview
The script performs the following steps:

1. **Load Configuration**: Reads the configuration variables from the config.yaml file.
2. **Initialize API**: Authenticates and initializes the Google Drive API with impersonation.
3. **Copy to Temporary Location**: Recursively copies the source folder and its contents to a temporary location.
4. **Move to Shared Drive**: Recreates the folder structure in the Shared Drive and moves the copied files.
5. **Logging**: Logs any failed copy operations to a CSV file with a timestamp.

### Error Handling
Any failed copy operations are logged to a CSV file named `failed_copies_log_<timestamp>.csv`.
Errors encountered during file moves are printed to the console.

### Example config.yaml

``` yaml
service_account_file: 'path_to_your_service_account.json'
source_folder_id: '1A2B3C4D5E6F'
temp_parent_folder_id: '7G8H9I0J1K2L'
shared_drive_folder_id: '3M4N5O6P7Q8R'
delegated_user_email: 'admin@densho.us'
```

## Notes
Ensure that the service account has the necessary permissions to access the source folder and the Shared Drive.
The service account must be authorized for domain-wide delegation to impersonate the specified user.

## License
This project is licensed under the MIT License.
